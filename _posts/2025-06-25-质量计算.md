向Agent提问有关术语的含义和转换Markdown表格相关的。表格质量计算相关的。用Agent帮忙配置笔记文件相关的。

## 向Agent提问术语相关的问题

我使用agent过程是：

* 首先引用目前文件作为上下文。
* 一次只提一个问题，防止混淆。
* 将回答有用的部分转化为markdown格式直接写入笔记。

![agent0]({{ "/assets/images/2025-06-25/2025-06-25_15-20.png" | relative_url }})

## 质量计算

信息都要用到，缺一不可，都是需要用到的字段：

1. 公共信息：
包含时间戳、会话ID、用户标识等基础信息，用于数据关联、去重、统计、定位问题。
2. 移动网通用信息 / 互联网通用信息：
包含网络层、传输层的通用参数（如IP、端口、APN、网络类型等）用于分析网络环境、排查网络质量问题
3. 特定协议单请求信息/特定业务合成信息：
包含具体业务或协议的详细交互内容（如HTTP请求、MQTT消息等）直接反映业务质量（如响应时延、成功率等）

## 移动网通用信息

### Qos Flow 1 5QI
【释义】Qos flow 5QI
【初始值】全F
【取值范围】1,2,3,4,65,66,67,75,5,6,7,8,9,69,70,79,80,82,83,84,85
【处理方式】由合成服务器回填。

什么是服务器回填？“服务器回填”指的是：  
该字段在原始采集时可能没有值，或者初始值为全F（无效值）。
后续由合成服务器（即数据处理/分析服务器）根据其他信息（如信令、业务上下文）推断、补全该字段的真实值。
这样可以保证后续质量统计和分析时，字段数据更完整、更准确。

### QOS flow Iedntifier

QoS Flow Identifier (QFI) 关键字段，标识该数据包属于哪个QoS流（即5QI业务流）从Header中的PDU Session Container提取。

协议：GTP-U本身是一种协议，规定了数据如何在网络中封装、传输和解析。全称为GTP-U（GPRS Tunneling Protocol User Plane）
GTP-U协议用于移动通信网络（如4G/5G）中，承载用户数据（如上网流量、语音等）的隧道协议。

包头：GTP-U包头（Header），是GTP-U协议数据包的头部信息部分。协议规定了数据包的结构，每个GTP-U数据包都必须有一个“包头”（Header），用于描述该包的类型、长度、隧道ID等关键信息。

拓展头：PDU Session Container扩展头是5G核心网GTP-U协议（GPRS Tunneling Protocol User Plane）中新引入的一种扩展头部，用于在用户面数据包中携带5G专有的附加信息。

1. 作用
携带5G专有信息：如QoS流标识（QFI）、下行时间戳、序列号等
支持5G新业务需求：如切片、超低时延、增强QoS等
实现精细化流量管理和质量保障
2. 结构
作为GTP-U包头的一个扩展部分，紧跟在GTP-U主头部后面
由多个字段组成，每个字段有特定的比特位和字节数（如QFI、RQI、PPI等）

## 特殊协议MQTT的字段

### MQTT 报文传输规则

单报文传输：

* 每个 MQTT 报文都是独立的
* 一次只能发送一个报文
* 每个报文都有固定的格式和类型

```
1. 客户端 → Broker: CONNECT (连接请求)
2. Broker → 客户端: CONNACK (连接确认)
3. 客户端 → Broker: SUBSCRIBE (订阅请求)
4. Broker → 客户端: SUBACK (订阅确认)
5. 客户端 → Broker: PUBLISH (发布消息)
6. Broker → 其他客户端: PUBLISH (转发消息)
```

| QoS | 长度 | 初始值 | 取值范围 |
|-----|-------|------|---------|
| 服务品质| 1字节 | 全F（0xFF） | 0-255（有效值为 0、1、2、3）|

### QoS（Quality of Service）字段定义

| 项目 | 内容 |
|------|------|
| **字段名称** | QoS |
| **长度** | 1 Byte（1字节） |
| **释义** | 发布服务质量级别 |
| **初始值** | 全F（即 0xFF，表示未定义或保留状态） |
| **取值范围** | 0 - 255（但实际有效值为 0、1、2、3） |
| **处理方式** | 依不同协议和报文类型从不同位置提取或设置 |

### QoS 有效值及其含义

| QoS 值 | 说明 |
|--------|------|
| 0 | **最多一次（At most once）**消息仅传输一次，不保证送达，适用于传感器数据等可容忍丢失的场景 |
| 1 | **至少一次（At least once）**发送方要求接收方确认收到消息，可能重复，适用于需要送达但可容忍重复的场景 |
| 2 | **恰好一次（Exactly once）**通过两阶段确认机制确保消息仅送达一次，适用于金融交易、控制命令等高要求场景 |
| 3 | **保留值（Reserved）**当前协议中未使用，可能用于将来扩展或特殊用途 |

虽然字段支持 0-255，但**协议中仅使用 0、1、2、3 四个值**，其余值为保留或非法。

### 其他消息中 QoS 的处理

对于协议中不涉及服务质量控制的报文（如 `PINGREQ`、`PINGRESP`、`DISCONNECT` 等），QoS字段填 **默认值**，为保留值（0xFF）。这些报文不需要确认或重传机制，因此不需要QoS等级。

### MQTT 协议中的 QoS 来源

| 报文类型 | QoS 字段来源 | 说明 |
|----------|---------------|------|
| `PUBLISH` | 从 **PUBLISH 固定头部** 中获取 | 用于指示该消息的发布服务质量等级 |
| `SUBSCRIBE` | 从 **SUBSCRIBE payload** 中获取第一个订阅项的 QoS | 客户端请求订阅时指定希望接收的 QoS 等级 |
| `CONNECT` | 从 **Connect 消息中的 Will QoS 字段** 获取 | 表示客户端断开时 Broker 发送遗嘱消息的 QoS 等级 |

### MQTT-SN 协议中的 QoS 来源

| 报文类型 | QoS 字段来源 | 说明 |
|----------|---------------|------|
| `WILLTOPIC` | 从 **WILLTOPIC 报文中的 will QoS 字段** 获取 | 设置客户端的遗嘱主题和服务质量等级 |
| `WILLTOPICUPD` | 从 **WILLTOPICUPD 报文中的 will QoS 字段** 获取 | 更新客户端的遗嘱主题信息 |
| `PUBLISH` | 从 **PUBLISH 报文头部或 payload 中解析** | 表示该消息的发布服务质量等级 |
| `SUBSCRIBE` / `SUBACK` | 从 **SUBSCRIBE 请求的 QoS 字段** 或 **SUBACK 返回的 QoS 字段** 获取 | 客户端请求的 QoS 与 Broker 实际响应的 QoS |

## Agent帮忙配置笔记

我使用agent帮忙自己省力的过程是：

* 首先不止引用目前文件，而是引用包含我的所有笔记配置文件的目录作为上下文。
* 一次转换多行为注释，同时转换中英文。

![质量计算图]({{ "/assets/images/2025-06-25/2025-06-25_14-34.png" | relative_url }})

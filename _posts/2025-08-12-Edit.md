### 结果

之前流数比例接近的问题原因查明。因为之前要清理掉多余的子文件夹和中间文件的路径，我把所有pcap相关的路径都删掉了。所以所有数据集共享同一个保存路径在循环中，每个split类型都使用相同的 `save_path_pcap`。每个后续的split处理都会包含前面所有split的数据，导致：验证集流数多于训练集流数，测试集流数多于验证集流数。

改动思路很简单，不按照行顺序一条条处理。先处理所有train，然后删掉中间各个app的对应的csv文件，依次这样处理。

把最后改动的程序放到服务器上，晚上放上去，早上来看一眼。

下面是一些基本信息、统计的流数和流协议的分布情况。

```bash
(.venv) [root@datanode62 corpus]# tree /data1/chatPcap_data/processed/ -L 3
/data1/chatPcap_data/processed/
└── pcap_2022_03
    ├── csv
    │   ├── testing.csv
    │   ├── training.csv
    │   └── validation.csv
    └── target
        └── dataset_split.csv

3 directories, 4 files
```

```bash
(.venv) [root@datanode62 corpus]# du -sh /data1/chatPcap_data/processed/pcap_2022_03/* && ls -lh /data1/chatPcap_data/processed/pcap_2022_03/csv/
14G     /data1/chatPcap_data/processed/pcap_2022_03/csv
11M     /data1/chatPcap_data/processed/pcap_2022_03/target
total 14G
-rw-r--r-- 1 root root 1.9G Aug 12 18:16 testing.csv
-rw-r--r-- 1 root root 9.4G Aug 12 17:03 training.csv
-rw-r--r-- 1 root root 2.7G Aug 12 17:46 validation.csv
```

```bash
(.venv) [root@datanode62 corpus]# echo "=== 训练集协议分布 ===" && cut -d',' -f4 /data1/chatPcap_data/processed/pcap_2022_03/csv/training.csv | tail -n +2 | sort | uniq -c | sort -nr
=== 训练集协议分布 ===
 867786 TLS
 369769 HTTP
  92328 UNKNOWN
     41 HTTPS
     19 GTP-U
```

```bash
(.venv) [root@datanode62 corpus]# echo "=== 验证集协议分布 ===" && cut -d',' -f4 /data1/chatPcap_data/processed/pcap_2022_03/csv/validation.csv | tail -n +2 | sort | uniq -c | sort -nr
=== 验证集协议分布 ===
 245723 TLS
 108542 HTTP
  31584 UNKNOWN
      8 HTTPS
      8 GTP-U
```

```bash
(.venv) [root@datanode62 corpus]# echo "=== 测试集协议分布 ===" && cut -d',' -f4 /data1/chatPcap_data/processed/pcap_2022_03/csv/testing.csv | tail -n +2 | sort | uniq -c | sort -nr
=== 测试集协议分布 ===
 175223 TLS
  77636 HTTP
  20517 UNKNOWN
      9 HTTPS
      3 GTP-U
```

```bash
(.venv) [root@datanode62 corpus]# echo "=== 总体统计 ===" && echo "训练集总流数: $(($(wc -l < /data1/chatPcap_data/processed/pcap_2022_03/csv/training.csv) - 1))" && echo "验证集总流数: $(($(wc -l < /data1/chatPcap_data/processed/pcap_2022_03/csv/validation.csv) - 1))" && echo "测试集总流数: $(($(wc -l < /data1/chatPcap_data/processed/pcap_2022_03/csv/testing.csv) - 1))"
=== 总体统计 ===
训练集总流数: 1329943
验证集总流数: 385865
测试集总流数: 273388
```